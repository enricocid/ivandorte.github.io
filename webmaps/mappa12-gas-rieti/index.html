<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>GeoJSON tutorial - Leaflet</title>

  <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

  <style>
    html,
    body {
      height: 100%;
      margin: 0;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .text_cluster div {
      width: 40px;
      height: 40px;
      display: inline-block;
      padding: 2px;
      border-style: solid;
      border-color: rgba(47, 79, 79, 1.0);
      background-color: rgba(255, 255, 255, 0.6);
      color: rgba(47, 79, 79, 1.0);
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
  </style>

</head>

<body>

  <div id='map'></div>

  <script src="./layers/01_texts.js" type="text/javascript"></script>
  <script src="./layers/02_lines.js" type="text/javascript"></script>

  <script>
    var map = L.map('map').setView([42.404224, 12.862539], 13);

    var tiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 23,
      subdomains: 'abcd',
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
    }).addTo(map);

    function add_popup(f, l) {
      var fields = Object.keys(f.properties);

      var json_data = JSON.stringify(f.properties, null, ' ').replace(/[\{\}"]/g, '');

      for (let i = 0; i < fields.length; i++) {
        var json_data = json_data.replace(fields[i], "<b>" + fields[i] + "</b>")
      }

      l.bindPopup('<pre>' + json_data + '</pre>');
    }

    function text_style(f, l) {
      add_popup(f, l);
      var popupContent = f.properties.text;
      l.bindTooltip(popupContent, { permanent: true, direction: 'auto', offset: [5, 3] });
    }

    function gas_style(f, l) {
      add_popup(f, l);
      l.setStyle({
        color: f.properties.color, weight: f.properties.width
      });
    }

    var markerGroup = new L.MarkerClusterGroup({
      maxClusterRadius: 120,
      spiderfyOnMaxZoom: false,
      showCoverageOnHover: false,
      zoomToBoundsOnClick: false,

    });

    var gas_labels = L.geoJSON(geo_texts, {
      pointToLayer: function (f, latlng) {
        return L.circleMarker(latlng, {
          radius: 2.3,
          color: 'red',
          opacity: 0.75,
        });
      },
      onEachFeature: text_style
    });

    markerGroup.addLayer(gas_labels);
    map.addLayer(markerGroup);

    var gas_lines = L.geoJSON(geo_lines, {
      onEachFeature: gas_style,
    }).addTo(map);

    map.fitBounds(gas_lines.getBounds());

  </script>



</body>

</html>